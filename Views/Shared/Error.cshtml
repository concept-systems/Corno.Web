@model System.Web.Mvc.HandleErrorInfo

@{
    Layout = "_AppLayout.cshtml";

    ViewBag.Title = "Error";
    var exception = ViewData["Exception"] as Exception;
    var message = ViewData["Message"] as string ?? Model?.Exception?.Message ?? "An error occurred while processing your request.";
    var stackTrace = exception?.StackTrace;
}

<div style="padding: 20px; font-family: Arial, sans-serif;">
    <h1 style="color: #d32f2f;">Error</h1>
    <h2 style="color: #d32f2f;">An error occurred while processing your request.</h2>
    
    @if (!string.IsNullOrEmpty(message))
    {
        <div style="margin-top: 20px; padding: 15px; background-color: #ffebee; border-left: 4px solid #d32f2f;">
            <h4 style="margin-top: 0;">Error Message:</h4>
            <p style="margin-bottom: 0;"><strong>@message</strong></p>
        </div>
    }
    
    @if (exception != null)
    {
        <div style="margin-top: 20px; padding: 15px; background-color: #fff3e0; border-left: 4px solid #ff9800;">
            <h4 style="margin-top: 0;">Exception Type:</h4>
            <p style="margin-bottom: 0;">@exception.GetType().FullName</p>
        </div>
        
        if (exception.InnerException != null)
        {
            <div style="margin-top: 20px; padding: 15px; background-color: #e3f2fd; border-left: 4px solid #2196f3;">
                <h4 style="margin-top: 0;">Inner Exception:</h4>
                <p style="margin-bottom: 0;"><strong>@exception.InnerException.GetType().Name:</strong> @exception.InnerException.Message</p>
            </div>
        }
        
        if (!string.IsNullOrEmpty(stackTrace))
        {
            <div style="margin-top: 20px;">
                <h4>Stack Trace:</h4>
                <pre style="background-color: #f5f5f5; padding: 15px; border: 1px solid #ddd; overflow-x: auto; max-height: 400px; font-size: 12px;">@stackTrace</pre>
            </div>
        }
    }
    
    @if (Model is { Exception: not null })
    {
        <div style="margin-top: 20px; padding: 15px; background-color: #e3f2fd; border-left: 4px solid #2196f3;">
            <h4 style="margin-top: 0;">Controller:</h4>
            <p style="margin-bottom: 5px;">@Model.ControllerName</p>
            <h4>Action:</h4>
            <p style="margin-bottom: 0;">@Model.ActionName</p>
        </div>
    }
    
    <div style="margin-top: 20px;">
        <a href="javascript:void(0)" onclick="goBackSafely()" style="display: inline-block; padding: 10px 20px; background-color: #2196f3; color: white; text-decoration: none; border-radius: 4px; margin-right: 10px;">Go Back</a>
        <a href="@Url.Action("Index", "Home")" style="display: inline-block; padding: 10px 20px; background-color: #757575; color: white; text-decoration: none; border-radius: 4px;">Go to Home</a>
    </div>
    
    <script type="text/javascript">
        function goBackSafely() {
            // Try to use referrer if available and from same origin
            var referrer = document.referrer;
            if (referrer && referrer.indexOf(window.location.origin) === 0) {
                var referrerPath = new URL(referrer).pathname;
                if (referrerPath && referrerPath !== window.location.pathname) {
                    window.location.href = referrer;
                    return;
                }
            }
            // Fallback to Home
            window.location.href = '@Url.Action("Index", "Home")';
        }
    </script>
</div>

