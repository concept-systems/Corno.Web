@using System.ComponentModel
@using Corno.Web.Globals
@using Kendo.Mvc.UI
@model Corno.Web.Areas.Nilkamal.Dto.Plan.PositionDetailDto

@{
    Layout = "~/Views/Shared/_LayoutDetails.cshtml";
    
    ViewBag.BoxTitle = "Position Details";
    ViewBag.Area = "Kitchen";
    ViewBag.Controller = "Plan";
    ViewBag.Index = "Index";
}

<div class="">
    <table class="table k-table k-table-alt-row w-100">
        <colgroup>
            <col style="width: auto;">
            <col style="width: 35%;">
            <col style="width: auto;">
            <col style="width: 35%;">
        </colgroup>
        <tbody>
        <tr>
            <td> Warehouse Order No :</td>
            <td>
                <strong>@Model.WarehouseOrderNo</strong>
            </td>
            <td> Position :</td>
            <td>
                <strong>@Model.Position</strong>
            </td>
        </tr>
        <tr>
            <td> Assembly Code :</td>
            <td>
                <strong>@Model.AssemblyCode</strong>
            </td>
            <td> Carcass Code :</td>
            <td>
                <strong>@Model.CarcassCode</strong>
            </td>
        </tr>
        <!--<tr>
        <td> Quantity :</td>
        <td><strong>@Model.Quantity</strong></td>
        <td> Order Quantity :</td>-->
        @*<td><strong>@Model.OrderQuantity</strong></td>*@
        <!--</tr>-->
        </tbody>
    </table>
    @*<script id="template-warehouse-Order" type="text/x-kendo-template">
             <h4>
                 @Html.DisplayFor(m => m.WarehouseOrderNo)
            </h4>
        </script>
        <script id="template-position" type="text/x-kendo-template">
          <h4>
              @Html.DisplayFor(m => m.Position)
         </h4>
        </script>
        <script id="template-assemblyCode" type="text/x-kendo-template">
             <h4>
             @Html.DisplayFor(m => m.AssemblyCode)
             </h4>
        </script>
        <script id="template-carcassCode" type="text/x-kendo-template">
             <h4>
             @Html.DisplayFor(m => m.CarcassCode)
             </h4>
        </script>*@
    <script id="template-position-labels" type="text/x-kendo-template">
            @(Html.Kendo().Grid(Model.PositionLabelDtos)
                .Name("gridLabels")
                .ToolBar(toolbar =>
                {
                    toolbar.Excel();
                    toolbar.Pdf();
                    toolbar.Search();
                })
                .Pageable()
                .Sortable(s => s.InitialDirection(ListSortDirection.Descending))
                .Filterable(f => f.Mode(GridFilterMode.Row))
                .Resizable(resize => resize.Columns(true)) // Allow column resizing
                .PersistSelection()
                .Height(540)
                .HtmlAttributes(new { style = "height: 200px;" })
                .Columns(columns =>
                {
                    columns.Bound(m => m.LabelDate)
                        .HtmlAttributes(new { style = "text-align: center" })
                        .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                        .Format("{0:dd/MM/yyyy}")
                        .Title("Date");
                    columns.Bound(m => m.Barcode)
                        .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                        .HtmlAttributes(new { style = "text-align: center" });
                    columns.Bound(m => m.CartonNo)
                        .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                        .HtmlAttributes(new { style = "text-align: center" });
                    columns.Bound(m => m.Status)
                        .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                        .HtmlAttributes(new { style = "text-align: center" });
                    columns.Command(command =>
                    {
                        // Show only if Status is "Active";
                        command.Custom("View").Text(" ").IconClass("k-icon k-i-preview k-i-eye")
                            .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                            .Click("onViewClick");
                    })
                        .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                        .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                        .Title("Actions"); // Add a class to identify the command column;
                })
                .Excel(excel => excel
                    .FileName("Items.xlsx")
                    .ProxyURL(Url.Action("Excel_Export_Save", "Corno"))
                )
                .Pdf(pdf => pdf
                    .FileName("Items.pdf")
                    .ProxyURL(Url.Action("Excel_Export_Save", "Corno"))
                )
                .DataSource(dataSource => dataSource
                    .Ajax()
                    .ServerOperation(false)
                    .Model(model => model.Id(FieldConstants.Id))).ToClientTemplate())
    </script>

    <script id="template-position-cartons" type="text/x-kendo-template">
           @(Html.Kendo().Grid(Model.PositionCartonDtos)
               .Name("gridCartons")
               .ToolBar(toolbar =>
               {
                   toolbar.Excel();
                   toolbar.Pdf();
                   toolbar.Search();
               })
               .Pageable()
               .Sortable(s => s.InitialDirection(ListSortDirection.Descending))
               .Filterable(f => f.Mode(GridFilterMode.Row))
               .Resizable(resize => resize.Columns(true)) // Allow column resizing
               .PersistSelection()
               .Height(540)
               .HtmlAttributes(new { style = "height: 200px;" })
               .Columns(columns =>
               {
                   columns.Bound(m => m.PackingDate)
                       .HtmlAttributes(new { style = "text-align: center" })
                       .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                       .Format("{0:dd/MM/yyyy}")
                       .Title("Date");
                   columns.Bound(m => m.CartonBarcode)
                       .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                       .HtmlAttributes(new { style = "text-align: center" });

                   columns.Bound(m => m.CartonNo)
                       .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                       .HtmlAttributes(new { style = "text-align: center" });

                   columns.Bound(m => m.Status)
                       .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                       .HtmlAttributes(new { style = "text-align: center" });

                   columns.Command(command =>
                   {
                       // Show only if Status is "Active";
                       command.Custom("View").Text(" ").IconClass("k-icon k-i-preview k-i-eye")
                           .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                           .Click("onCartonViewClick");
                   })
                       //.HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                       .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                       .Width(10)
                       .Title("Actions"); // Add a class to identify the command column;
               })
               .Excel(excel => excel
                   .FileName("Items.xlsx")
                   .ProxyURL(Url.Action("Excel_Export_Save", "Corno"))
               )
               .Pdf(pdf => pdf
                   .FileName("Items.pdf")
                   .ProxyURL(Url.Action("Excel_Export_Save", "Corno"))
               )
               .DataSource(dataSource => dataSource
                   .Ajax()
                   .ServerOperation(false)
                   .Model(model => model.Id(FieldConstants.Id))).ToClientTemplate()
               )

    </script>
    <div id="tileLayout"></div>
</div>

@(Html.Kendo().TileLayout()
    .Name("tileLayout")
    .Columns(5)
    .RowsHeight("70px")
    .ColumnsWidth("450px")
    .Containers(c => {
        //c.Add()
        //    .BodyTemplateId("position-header")
        //    .ColSpan(5)
        //    .RowSpan(2);
        c.Add()
           .Header(h => h.Text("Position Labels"))
           .BodyTemplateId("template-position-labels")
           .ColSpan(3)
           .RowSpan(4);
        c.Add()
            .Header(h => h.Text("Position Cartons"))
            .BodyTemplateId("template-position-cartons")
            .ColSpan(2)
            .RowSpan(4);

    })
    .Reorderable(true)
    .Resizable(true)

    )

<script type="text/javascript">

          function onViewClick(e) {
             e.preventDefault();
             var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
             var id = dataItem.Id; // Assuming 'Id' is the field name
             window.location.href = '@Url.Action("View", "PartLabel")' + '?id=' + id;
          }
        function onCartonViewClick(e) {
            e.preventDefault();
            var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
            var id = dataItem.Id; // Assuming 'Id' is the field name
            window.location.href = '@Url.Action("View", "NonWeighingPacking")' + '?id=' + id;
         }
    
            function onBack() {
                // Try to use referrer if available and from same origin
                var referrer = document.referrer;
                if (referrer && referrer.indexOf(window.location.origin) === 0) {
                    var referrerPath = new URL(referrer).pathname;
                    if (referrerPath && referrerPath !== window.location.pathname) {
                        window.location.href = referrer;
                        return;
                    }
                }
                // Fallback to Plan/View
                window.location.href = '@Url.Action("View", "Plan", new { area = "Nilkamal" })';
            }
</script>
