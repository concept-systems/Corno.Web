@using Corno.Web.Globals
@using Corno.Web.Helper
@using Kendo.Mvc.UI
@model Corno.Web.Areas.Kitchen.Dto.Label.PartLabelCrudDto

@{
    Layout = "~/Views/Shared/_LayoutBase.cshtml";
}

@{
    ViewBag.BoxTitle = "Create New Part Label";
    ViewBag.SubmitAction = "Create";
}

@{
    ViewBag.MainMenu = "Transaction";
    ViewBag.MainHeader = "Part Label";
    ViewBag.CurrentSitemap = "Part Label";
    ViewBag.Title = "Part Label";
    ViewBag.Area = "Kitchen";
    ViewBag.Controller = "Label";
    ViewBag.Index = "Index";
    
    // Set for shared partial - Label controller has different action names
    ViewBag.GetItemsAction = ViewBag.GetItemsAction ?? "GetPartLabelItems";
    ViewBag.PrintAction = ViewBag.PrintAction ?? "PrintPartLabel";
    ViewBag.PreviewAction = ViewBag.PreviewAction ?? "PreviewPartLabel";
    ViewBag.PrintPath = ViewBag.PrintPath ?? "/Label/PrintPartLabel";
    ViewBag.PreviewPath = ViewBag.PreviewPath ?? "/Label/PreviewPartLabel";
}

@section sectionBaseFooter
{
    <div class="k-actions k-actions-horizontal k-actions-end">
        @(Html.Kendo().Button()
            .Name("btnBack")
            .Content("Back")
            .ApplyStandardSettingsWithType(ButtonType.Info, "arrow-60-left", ComponentSize.Medium)
            .HtmlAttributes(new { onclick = $"window.location.href='{Url.Action("Index", "Label", new { area = "Kitchen" })}'; return false;" }))
        @(Html.Kendo().Button()
            .Name("preview")
            .Content("Preview")
            .ApplyStandardSettingsWithType(ButtonType.Info, "preview", ComponentSize.Medium)
            .Events(e => e.Click("onPreview")))
        @(Html.Kendo().Button()
            .Name("print")
            .Content("Print")
            .ApplyStandardSettingsWithType(ButtonType.Primary, "print", ComponentSize.Medium)
            .Events(e => e.Click("onPrint")))
    </div>
}

@(Html.Kendo().TileLayout()
    .Name("tileLayout")
    .Columns(2)
    .RowsHeight("100%")
    .ColumnsWidth("100%")
    .Containers(c => {
         c.Add()
             .BodyTemplateId("partial-view")
             .Header(h => h.Text("Header Info"))
             .ColSpan(1)
             .RowSpan(4);
         c.Add()
             .BodyTemplateId("template-items-Info")
             .Header(h => h.Text("Items Info"))
             .ColSpan(1)
             .RowSpan(4);
    })
    .Reorderable(true)
    .Resizable(true))

<script id="partial-view" type="text/x-kendo-template">
    <div class="col-12">
          <!-- Placeholder for the partial view -->
    </div>
</script>
<script id="template-items-Info" type="text/x-kendo-template">
  <div class="k-content">
         @Html.Partial("Shared/_PartLabel", Model)
  </div>
</script>

<script>
    function onPrint(e) {
        e.preventDefault();
        const formData = buildFormData();
        fetchAndPrint('@ViewBag.PrintPath', formData, onPrintSuccess);
    }

    function onPreview(e) {
        e.preventDefault();
        const formData = buildFormData();
        fetchAndPreviewPdf('@ViewBag.PreviewPath', formData, "Part Label");
    }
</script>

